<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Panel Host</title>
  <style>
    body{margin:0;font-family:Segoe UI,system-ui;background:#071120;color:#fff}
    .wrap{max-width:900px;margin:40px auto;padding:0 18px}
    .card{background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.12);
      border-radius:18px;padding:18px;box-shadow:0 20px 60px rgba(0,0,0,.45)}
    h1{margin:0 0 6px 0}
    .muted{opacity:.85;margin:0 0 18px}
    .row{display:flex;gap:12px;align-items:center}
    input,button{height:46px;border-radius:14px;border:1px solid rgba(255,255,255,.18);
      background:rgba(0,0,0,.25);color:#fff;padding:0 14px;font-size:16px}
    input{flex:1}
    button{min-width:160px;background:#2f6df6;border:none;font-weight:700;cursor:pointer}
    button:hover{filter:brightness(1.06)}
    .hidden{display:none}
    .ok{color:#7CFFB2}
    .warn{color:#ffcf6e}
    .btn2{background:#16a34a}
    .btn3{background:#ef4444}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>üë©‚Äçüè´ Panel Host (Licda = t√∫)</h1>
    <p class="muted">Control en vivo ‚Äî El Viaje Digital del Cliente</p>

    <div class="card" id="loginCard">
      <div class="row">
        <input id="pin" value="2026" placeholder="PIN (2026)" />
        <button id="btnEntrar">Entrar</button>
      </div>
      <p class="muted" style="margin-top:10px">Si no entra, era porque Firebase no estaba cargando.</p>
    </div>

    <div class="card hidden" id="panelCard" style="margin-top:16px">
      <h2 style="margin:0 0 10px 0">üéÆ Controles</h2>
      <div class="row" style="flex-wrap:wrap">
        <button class="btn2" id="btnLobby">Mandar a Lobby</button>
        <button class="btn2" id="btnIniciar">Iniciar Juego</button>
        <button class="btn3" id="btnReset">Reset</button>
      </div>

      <p class="muted" style="margin:14px 0 8px">Estado:</p>
      <div id="estado" class="warn">Cargando‚Ä¶</div>
    </div>
  </div>

  <script type="module">
    import { db, ref, set, onValue, serverTimestamp } from "./firebase.js";
    
    const PIN_OK = "2026";

    const loginCard = document.getElementById("loginCard");
    const panelCard = document.getElementById("panelCard");
    const estado = document.getElementById("estado");

    const btnEntrar = document.getElementById("btnEntrar");
    const btnLobby = document.getElementById("btnLobby");
    const btnIniciar = document.getElementById("btnIniciar");
    const btnReset = document.getElementById("btnReset");

    btnEntrar.onclick = async () => {
      const pin = document.getElementById("pin").value.trim();
      if (pin !== PIN_OK) return alert("PIN incorrecto üòÖ (debe ser 2026)");

      loginCard.classList.add("hidden");
      panelCard.classList.remove("hidden");

      // Deja el juego listo en lobby
      await set(ref(db, "game/state"), { phase: "lobby", updatedAt: serverTimestamp() });
    };

    btnLobby.onclick = () => set(ref(db, "game/state"), { phase: "lobby", updatedAt: serverTimestamp() });
    btnIniciar.onclick = () => set(ref(db, "game/state"), { phase: "juego", updatedAt: serverTimestamp() });
    btnReset.onclick = () => set(ref(db, "game"), { state: { phase: "lobby", updatedAt: serverTimestamp() } });

    // Ver estado en vivo
    onValue(ref(db, "game/state"), (snap) => {
      const v = snap.val();
      if (!v) { estado.textContent = "Sin estado a√∫n"; return; }
      estado.className = "ok";
      estado.textContent = "phase = " + v.phase;
    });
  </script>
</body>
</html>

