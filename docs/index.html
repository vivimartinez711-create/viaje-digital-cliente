<script type="module">
  import { entrarAlSalon, escucharSalon } from "./firebase.js";

  const listaDiv = document.getElementById("lista");
  const btn = document.querySelector("button[onclick='entrar()']");

  // Pintar salÃ³n
  escucharSalon((jugadores) => {
    if (!listaDiv) return;

    if (!jugadores.length) {
      listaDiv.innerHTML = "AÃºn no hay estudiantes en el salÃ³nâ€¦";
      return;
    }

    jugadores.sort((a,b) => (b.updatedAt||0) - (a.updatedAt||0));

    listaDiv.innerHTML = jugadores
      .slice(0, 50)
      .map(j => {
        const hearts = "â¤ï¸".repeat(Math.max(0, Math.min(10, Number(j.vidas ?? 5))));
        const estado = j.estado === "salio" ? " â€” saliÃ³" : "";
        return `â€¢ ${j.nombre || "Anon"} ${hearts}${estado}`;
      })
      .join("<br>");
  });

  // Tu funciÃ³n entrar() (la conectamos a Firebase)
  window.entrar = function () {
    const nombre = document.getElementById("nombre")?.value?.trim();
    if (!nombre) return alert("Escribe tu nombre primero ğŸ˜Š");

    const transporte = document.getElementById("transporte")?.value || "bus";
    const piel = document.getElementById("piel")?.value || "media";
    const pelo = document.getElementById("pelo")?.value || "negro";
    const ropa = document.getElementById("ropa")?.value || "azul";

    entrarAlSalon({ nombre, transporte, piel, pelo, ropa, vidas: 5 });

    alert("Â¡Listo! Entraste al salÃ³n ğŸ“âœ…\nAhora todos te verÃ¡n en vivo.");
    if (btn) btn.disabled = true;
  };
</script>

